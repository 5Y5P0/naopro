@{
    ViewData["Title"] = "Nos services";
    string tvaNonApplicable = "Aucune taxe : TVA non applicable, art. 293B du CGI";
    string fraisInclus = "Coût de la prestation inclu dans le prix négocié";
}

<style>

    /* Always set the map height explicitly to define the size of the div
     * element that contains the map. */
    #map {
        min-height: 400px;
    }

    .row {
        margin-bottom: 20px
    }

    .card-deck {
        margin: 0px;
    }

        .card-deck .card {
            margin-bottom: 0px;
            margin-top: 15px;
            margin-left: 7.5px;
            margin-right: 7.5px;
        }

    .card-map-top {
        padding: 10px;
    }

    .card-map-form {
        padding: 15px;
        width: 100%;
    }
</style>

<div class="container">

    <div class="row">

        <div class="card-deck">
            <div class="card">
                <img class="card-img-top" src="~/Images/accounting-3190208_640.jpg" alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title">Achat</h5>
                    <div class="card-text">
                        <p>Nous vous accompagnons dans l'acquisition de vos équipements et logiciels informatiques.</p>
                        <p>A partir de votre besoin, nous sélectionnons ensemble les propositions. Puis, nous négocions pour vous les conditions tarifaires.</p>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <small class="text-muted"><label style="font-weight:bold;font-style: italic;font-size-adjust:1.1">Sur devis<sup><abbr title="@fraisInclus"> (1)</abbr></sup></label></small>
                </div>
            </div>
            <div class="card">
                <img class="card-img-top" src="~/Images/web-design-2038872_640x423.jpg" alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title" style="">Développement</h5>
                    <div class="card-text">
                        <p>Nous réalisons des sites internet sur-mesure.</p>
                        <p>Après une étude de vos souhaits, nous concevons un site WEB dédié pour répondre au mieux à vos attentes.</p>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <small class="text-muted"><label style="font-weight:bold;font-style: italic;font-size-adjust:1.1">400 euros<sup><abbr title="@tvaNonApplicable"> (2)</abbr></sup> / jour</label></small>
                </div>
            </div>
            <div class="card">
                <img class="card-img-top" src="~/Images/software-development-4165307_640.jpg" alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title">Formation</h5>
                    <div class="card-text">
                        <p>Nous vous enseignons à devenir autonome sur vos outils informatiques.</p>
                        <p>Selon vos cas d'utilisation, nous créons un programme adéquate qui vous permettra d'utiliser vos équipements sans aide.</p>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <small class="text-muted"><label style="font-weight:bold;font-style: italic;font-size-adjust:1.1">50 euros<sup><abbr title="@tvaNonApplicable"> (2)</abbr></sup> / heure</label></small>
                </div>
            </div>

        </div>

        <div class="card-deck">

            <div class="card">
                <img class="card-img-top" src="~/Images/computer-3343887_640x423.jpg" alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title">Assistance</h5>
                    <div class="card-text">
                        <p>Nous vous aidons à résoudre vos problèmes informatiques.</p>
                        <p>Après analyse des difficultés que vous rencontrez, nous déterminons ensemble la meilleure solution.</p>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <small class="text-muted"><label style="font-weight:bold;font-style: italic;font-size-adjust:1.1">50 euros<sup><abbr title="@tvaNonApplicable"> (2)</abbr></sup> / heure</label></small>
                </div>
            </div>
            <div class="card">
                <img class="card-img-top" src="~/Images/application-3399516_640x423.jpg" alt="Card image cap">
                <div class="card-body">
                    <h5 class="card-title">Conseil</h5>
                    <div class="card-text">
                        <p>Nous vous proposons également des services sur-mesure.</p>
                        <p>Vous avez un autre besoin, nous pouvons vous guider dans la réalisation de votre projet.</p>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <small class="text-muted"><label style="font-weight:bold;font-style: italic;font-size-adjust:1.1">Sur devis<sup><abbr title="@fraisInclus"> (1)</abbr></sup></label></small>
                </div>
            </div>
            <div class="card border-0">
                <div class="card-body">
                    <div class="card-text">
                        <ul style="list-style:none;padding-left:0;">
                            <li style="font-style: italic"><small class="text-muted">(1) @fraisInclus</small></li>
                            <li style="font-style: italic"><small class="text-muted">(2) @tvaNonApplicable</small></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <div class="row">
               
        <div class="card-deck">

            <div class="card">

                <div class="card-body">
                    <div class="card-title"><h5>Zone de déplacement à domicile : Saint-grégoire (35760)</h5></div>
                    <div id="map"></div>
                </div>

                <form class="card-body">
                    <div class="form-row">
                        <div class="col-md-12">
                            <label for="inputLocation">Mon emplacement</label>
                            <input type="text" class="form-control is-valid" id="inputLocation" placeholder="Saisissez votre adresse ..." required>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" type="submit">Vérifier mon addresse</button>
                </form>

            </div>

        </div>

    </div>

</div>

@section Scripts
{
    @*key=AIzaSyAMm968DvdBSqzKuyALgIKxQqUaVfBvxjw&*@
    <script async defer src="https://maps.googleapis.com/maps/api/js?callback=initMap&libraries=geometry">
    </script>
    <script type="text/javascript">

        var map;
        var markers = [];
        var infoWindow;

        $(document).ready(function () {

            var form = $('#addressForm')[0];
            form.onsubmit = function (e) {

                event.preventDefault();
                /* fire your validation and $.post */

                var a = $("#addressForm :input")[0].value;

                displayAddress(a);

                return false;

            }

        });

        function isInPolygon(e) {
            var coordinate = new google.maps.LatLng(e.lat, e.lng);
            return google.maps.geometry.poly.containsLocation(coordinate, yourPolygon);
        }

        // Adds a marker to the map and push to the array.
        function addMarker(location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map,
                icon: {
                    url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                }
            });
            markers.push(marker);
        }

        // Sets the map on all markers in the array.
        function setMapOnAll(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }

        // Removes the markers from the map, but keeps them in the array.
        function clearMarkers() {
            setMapOnAll(null);
        }

        // Shows any markers currently in the array.
        function showMarkers() {
            setMapOnAll(map);
        }

        // Deletes all markers in the array by removing references to them.
        function deleteMarkers() {
            clearMarkers();
            markers = [];
        }

        function displayAddress(value) {

            $.ajax({
                url: 'https://api-adresse.data.gouv.fr/search/?q=' + encodeURI(value) + '&limit=1',
                //data: data,
                processData: false,
                contentType: false,
                type: 'GET',
                success: function (data) {

                    if (data.features[0].geometry.coordinates.length > 0) {

                        jsonText = '{"lng": ' + data.features[0].geometry.coordinates[0] + ', "lat": ' + data.features[0].geometry.coordinates[1] + "}";
                        //alert(jsonText);
                        coords = JSON.parse(jsonText);

                        deleteMarkers();
                        addMarker(new google.maps.LatLng(coords.lat, coords.lng));

                    }

                },
                error: function (xhrRequest, status, error) {
                    alert(JSON.stringify(xhrRequest));
                }
            });

        }

        function initMap() {

            $.getJSON("/polygon-saint-gregoire.json", function (city) {

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 12,
                    center: city.center,
                    mapTypeId: 'terrain'
                });

                // Define the LatLng coordinates for the polygon.

                // http://theopenmap.herokuapp.com/api/v2_coordinates/
                // + body { location:35760+Saint-Grégoire }

                // Construct the polygon.
                var bermudaTriangle = new google.maps.Polygon({
                    paths: city.coords,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 3,
                    fillColor: '#FF0000',
                    fillOpacity: 0.2
                });
                bermudaTriangle.setMap(map);

                // Add a listener for the click event.
                bermudaTriangle.addListener('click', showArrays);

                infoWindow = new google.maps.InfoWindow;

            });

        }

        /** this {google.maps.Polygon} */
        function showArrays(event) {
            // Since this polygon has only one path, we can call getPath() to return the
            // MVCArray of LatLngs.
            var vertices = this.getPath();

            var contentString = '<b>Bermuda Triangle polygon</b><br>' +
                'Clicked location: <br>' + event.latLng.lat() + ',' + event.latLng.lng() +
                '<br>';

            // Iterate over the vertices.
            for (var i = 0; i < vertices.getLength(); i++) {
                var xy = vertices.getAt(i);
                contentString += '<br>' + 'Coordinate ' + i + ':<br>' + xy.lat() + ',' +
                    xy.lng();
            }

            // Replace the info window's content and position.
            infoWindow.setContent(contentString);
            infoWindow.setPosition(event.latLng);

            infoWindow.open(map);
        }

    </script>
}
